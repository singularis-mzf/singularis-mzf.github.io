<!doctype html>
<html lang="cs">
<head profile="http://www.w3.org/2005/10/profile">
<meta charset="UTF-8">
<title>GNU make − Linux: Kniha kouzel</title>
<link rel="stylesheet" type="text/css" href="lkk.css">
<link rel="icon" type="image/png" href="obrazky/favicon.png">
</head>
<body>
<header>
<span class="left"><img src="obrazky/favicon.png" width="16" height="16" alt=""> Linux: Kniha kouzel, vanilková příchuť 1.0</span>
<span class="right"><span class="ico1"></span><span class="ico2"></span><span class="ico3"></span></span>
</header>
<nav class="horni">
<div class="slogan">Veškerá moc příkazové řádky/příkazového řádku přehledně, pro začátečníky i&nbsp;pokročilé</div>
<span class="prev">
<a href="docker.htm" rel="prev" title="7. Docker">Předchozí&nbsp;kapitola</a>&nbsp;|
</span><a href="index.htm">Přehled</a><span class="next"><!--
-->&nbsp;| <a href="zpracovani-videa-a-zvuku.htm" rel="next" title="9. Zpracování videa a zvuku">Následující&nbsp;kapitola</a>
</span>
<div class="rozcestnikkapitol"><a href="#cast1" class="cast">Úvod</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast2" class="cast">Definice</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast3" class="cast">Zaklínadla (v souboru Makefile)</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast4" class="cast">Parametry příkazů</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast5" class="cast">Instalace na Ubuntu</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast6" class="cast">Ukázka</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast7" class="cast">Tipy a zkušenosti</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast8" class="cast">Jak získat nápovědu</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast9" class="cast">Odkazy</a><span class="oddelovac">&nbsp;|</span>
<a href="#cast10" class="cast">Snímek obrazovky</a><span class="oddelovac">&nbsp;|</span>
</div>
</nav>
<article>
<h1>8. GNU make</h1>

<h2 id="cast1"><span class="cislo">1.</span> Úvod</h2>
<p class="ponadpisu">
GNU make je nástroj k automatizaci procesu sestavování určitých cílových souborů ze souborů zdrojových. Vykonává podobnou úlohu jako např. skript napsaný v bashi, ale na rozdíl od něj umí:
</p>
<ul style="text-align:left"><li>Kompilovat pouze ty části programu, které jsou potřeba (jejichž cílové soubory neexistují nebo se jejich zdrojové soubory změnily).
</li><li>Spouštět procesy paralelně, aniž by to narušilo definované závislosti.
</li></ul><p>
Vztahy mezi zdrojovými a cílovými soubory a kompilační příkazy jsou popsány
v tzv. Makefilu (souboru jménem „Makefile“),
jemuž se bude věnovat většina této kapitoly.
</p>

<h2 id="cast2"><span class="cislo">2.</span> Definice</h2>
<ul style="text-align:justify"><li><b>Pravidlo</b> je definice v Makefilu, která instruuje program make, na kterých dalších souborech určitý soubor závisí a jakými příkazy jej z nich vytvořit či aktualizovat.
</li><li><b>Cíl</b> je název souboru k vytvoření či akce k vykonání.
</li><li><b>Zdroj</b> (často nazýváný „závislost“) je název souboru, na kterém určitý cíl závisí. Příkazy stanovené pravidlem se vykonají jen tehdy, pokud cíl neexistuje nebo je alespoň jeden jeho z jeho zdrojů novější. (Vychází se z času poslední změny souborů.) Zdrojem může být také název akce.
</li><li><b>Slovo</b> je posloupnost nebílých znaků v řetězci. Jednotlivá slova v řetězci jsou od sebe oddělena bílými znaky, nejčastěji jednotlivou mezerou.
</li><li><b>%-vzor</b> je řetězec sloužící k filtrování, vyhledávání a nahrazování slov. Jde o velice praktickou věc. Může obsahovat nejvýše jeden znak <b>%</b>, který slouží jako náhrada za libovolné množství znaků (včetně lomítek oddělujících adresáře). (Např. %-vzoru <b>a%</b> odpovídají právě ta slova, která začínají malým písmenem <b>a</b>.) Slouží-li %-vzor k záměně, slova, která mu neodpovídají, projdou záměnou nezměněna. %-vzor nemusí obsahovat znak %; v takovém případě mu odpovídají pouze slova, která se s ním přesně shodují.
</li></ul>
<h2 id="cast3"><span class="cislo">3.</span> Zaklínadla (v souboru Makefile)</h2>

<h3 id="cast3x1"><span class="cislo">1</span> Nastavení proměnných</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>nastavit proměnnou (expandovat v místě definice)</div><div class="radky">
<div class="radekzaklinadla"><i class="dopln">NÁZEV_PROMĚNNÉ</i> := <i class="dopln">hodnota včetně mezer</i></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>připojit obsah na konec proměnné (expanze stejně jako v původní definici)</div><div class="radky">
<div class="radekzaklinadla"><i class="dopln">NÁZEV_PROMĚNNÉ</i> += <i class="dopln">hodnota včetně mezer</i></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>nastavit proměnnou (expandovat v každém místě použití)</div><div class="radky">
<div class="radekzaklinadla"><i class="dopln">NÁZEV_PROMĚNNÉ</i> = <i class="dopln">hodnota včetně mezer</i></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>přiřadit do proměnné mezeru (trik)</div><div class="radky">
<div class="radekzaklinadla">PRAZDNA :=</div>
<div class="radekzaklinadla"><i class="dopln">NÁZEV_PROMĚNNÉ</i> := $(PRAZDNA)<span class="viditelnamezera">&nbsp;</span>$(PRAZDNA)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>nastavit/připojit víceřádkový obsah<sup><a href="#ppc1" id="ppcr1">(1)</a></sup></div><div class="radky">
<div class="radekzaklinadla">define <i class="dopln">NÁZEV_PROMĚNNÉ</i> <span class="volznak">[</span><i class="dopln">operátor</i><span class="volznak">]</span></div>
<div class="radekzaklinadla"><i class="dopln">víceřádkový obsah</i></div>
<div class="radekzaklinadla">endef</div>
</div></div>

<h3 id="cast3x2"><span class="cislo">2</span> Rozvoj proměnných</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>rozvinout proměnnou</div><div class="radky">
<div class="radekzaklinadla">$(<i class="dopln">NÁZEV_PROMĚNNÉ</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>při rozvinutí proměnné nahradit v každém slově prefix/suffix/obojí<sup><a href="#ppc2" id="ppcr2">(2)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(<i class="dopln">NÁZEV_PROMĚNNÉ</i>:<span class="volznak">[</span><i class="dopln">původní-prefix</i><span class="volznak">]</span>%=<span class="volznak">[</span><i class="dopln">nový-prefix</i><span class="volznak">]</span>%)</div>
<div class="radekzaklinadla">$(<i class="dopln">NÁZEV_PROMĚNNÉ</i>:%<span class="volznak">[</span><i class="dopln">původní-suffix</i><span class="volznak">]</span>=%<span class="volznak">[</span><i class="dopln">nový-suffix</i><span class="volznak">]</span>)</div>
<div class="radekzaklinadla">$(<i class="dopln">NÁZEV_PROMĚNNÉ</i>:<span class="volznak">[</span><i class="dopln">původní-prefix</i><span class="volznak">]</span>%<span class="volznak">[</span><i class="dopln">původní-suffix</i><span class="volznak">]</span>=<span class="volznak">[</span><i class="dopln">nový-prefix</i><span class="volznak">]</span>%<span class="volznak">[</span><i class="dopln">nový-suffix</i><span class="volznak">]</span>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>rozvinout proměnnou prostředí či příkazového interpretu (ne proměnnou Makefilu)(alternativy)</div><div class="radky">
<div class="radekzaklinadla">$$<i class="dopln">NÁZEV_PROMĚNNÉ</i></div>
<div class="radekzaklinadla">$${<i class="dopln">NÁZEV_PROMĚNNÉ</i>}</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>rozvinout proměnnou, jejíž název je uložený v jiné proměnné</div><div class="radky">
<div class="radekzaklinadla">$($(<i class="dopln">NÁZEV_PROMĚNNÉ</i>))</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>příklad záměny při rozvoji − vypíše: bbeceda.cpp hlavicka.h bbakus.cpp ostatni.cc</div><div class="radky">
<div class="radekzaklinadla">TEST := abeceda.cc hlavicka.h abakus.cc ostatni.cc</div>
<div class="radekzaklinadla">all:</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>@echo $(TEST:a%.cc=b%.cpp)</div>
</div></div>

<h3 id="cast3x3"><span class="cislo">3</span> Automatické a předdefinované proměnné</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>cíl pravidla (alternativy)</div><div class="radky">
<div class="radekzaklinadla">$@</div>
<div class="radekzaklinadla">$(@)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>první zdroj pravidla (alternativy)</div><div class="radky">
<div class="radekzaklinadla">$&lt;</div>
<div class="radekzaklinadla">$(&lt;)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>všechny zdroje (alternativy)</div><div class="radky">
<div class="radekzaklinadla">$^</div>
<div class="radekzaklinadla">$(^)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>mazání souborů (typicky „rm -f“)</div><div class="radky">
<div class="radekzaklinadla">$(RM)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>program make</div><div class="radky">
<div class="radekzaklinadla">$(MAKE)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#6 </span>v generovaném a implicitním pravidle posloupnost znaků odpovídající znaku % v %-vzoru cíle (alternativy)</div><div class="radky">
<div class="radekzaklinadla">$*</div>
<div class="radekzaklinadla">$(*)</div>
</div></div>

<h3 id="cast3x4"><span class="cislo">4</span> Obecný tvar pravidel</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>normální (pevné) pravidlo</div><div class="radky">
<div class="radekzaklinadla"><i class="dopln">cíle oddělené mezerami</i>: <span class="volznak">[</span><i class="dopln">zdroje oddělené mezerami</i><span class="volznak">]</span> <span class="volznak">[</span>;<i class="dopln">příkaz</i><span class="volznak">]</span></div>
<div class="radekzaklinadla"><span class="volznak">[</span><span class="tab" style="width:8ch">&#9;</span><span class="volznak">[</span><i class="dopln">prefix-příkazu</i><span class="volznak">]</span><i class="dopln">příkaz</i><span class="volznak">]</span><span class="tritecky">...</span></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>zobecněné (generované) pravidlo (zdroje lze odvodit od cíle)</div><div class="radky">
<div class="radekzaklinadla"><i class="dopln">cíle oddělené mezerami</i>: <i class="dopln">%-vzor-pro-cíle</i>: <i class="dopln">cesta-nebo-%-vzor-zdroje</i><span class="tritecky">...</span> <span class="volznak">[</span>;<i class="dopln">příkaz</i><span class="volznak">]</span></div>
<div class="radekzaklinadla"><span class="volznak">[</span><span class="tab" style="width:8ch">&#9;</span><span class="volznak">[</span><i class="dopln">prefix-příkazu</i><span class="volznak">]</span><i class="dopln">příkaz</i><span class="volznak">]</span><span class="tritecky">...</span></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>obecné (implicitní) pravidlo (zdroje lze odvodit od cíle)<sup><a href="#ppc3" id="ppcr3">(3)</a></sup></div><div class="radky">
<div class="radekzaklinadla"><i class="dopln">%-vzor cíle</i><span class="tritecky">...</span>: <i class="dopln">cesta-nebo-%-vzor-zdroje</i><span class="tritecky">...</span> <span class="volznak">[</span>;<i class="dopln">příkaz</i><span class="volznak">]</span></div>
<div class="radekzaklinadla"><span class="volznak">[</span><span class="tab" style="width:8ch">&#9;</span><span class="volznak">[</span><i class="dopln">prefix-příkazu</i><span class="volznak">]</span><i class="dopln">příkaz</i><span class="volznak">]</span><span class="tritecky">...</span></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>označit, že určité cíle jsou akce, ne soubory</div><div class="radky">
<div class="radekzaklinadla">.PHONY: <span class="volznak">[</span><i class="dopln">akce oddělené mezerami</i><span class="volznak">]</span></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>přeložit soubory uvedené v proměnné ZDROJE, které se nacházejí v adresáři „kod“ a jeho podadresářích a mají příponu „.cc“, na objektové soubory do adresáře obj<sup><a href="#ppc4" id="ppcr4">(4)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(patsubst kod/%.cc,obj/%.o,$(filter kod/%.cc,$(ZDROJE))): obj/%.o: kod/%.cc</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(CXX) $(CXXFLAGS) -c -o $@ $&lt;</div>
</div></div>

<h3 id="cast3x5"><span class="cislo">5</span> Textové funkce</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>připojit text před/za každé slovo v řetězci/v rozvoji proměnné<sup><a href="#ppc5" id="ppcr5">(5)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(addprefix <i class="dopln">text-před</i>,<i class="dopln">řetězec slov</i>)</div>
<div class="radekzaklinadla">$(addsuffix <i class="dopln">text-za</i>,<i class="dopln">řetězec slov</i>)</div>
<div class="radekzaklinadla">$(<i class="dopln">proměnná</i>:%=<i class="dopln">text-před</i>%<i class="dopln">text-za</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>provést náhradu (záměnu) ve slovech pomocí %-vzoru</div><div class="radky">
<div class="radekzaklinadla">$(patsubst <i class="dopln">co-nahradit-%-vzor</i>,<i class="dopln">čím-nahradit-%-vzor</i>,<i class="dopln">řetězec slov</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>vybrat slova odpovídající/neodpovídající kterémukoliv ze zadaných %-vzorů</div><div class="radky">
<div class="radekzaklinadla">$(filter <i class="dopln">%-vzory oddělené mezerou</i><span class="tritecky">...</span>,<i class="dopln">řetězec slov</i>)</div>
<div class="radekzaklinadla">$(filter-out <i class="dopln">%-vzory oddělené mezerou</i><span class="tritecky">...</span>,<i class="dopln">řetězec slov</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>nahradit všechny výskyty podřetězce</div><div class="radky">
<div class="radekzaklinadla">$(subst <i class="dopln">co nahradit</i>,<i class="dopln">čím nahradit</i>,<i class="dopln">původní text</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>normalizovat bílé znaky (posloupnosti nahradit jednou mezerou, na začátku a konci odstranit)</div><div class="radky">
<div class="radekzaklinadla">$(strip <i class="dopln">řetězec</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#6 </span>získat počet slov v řetězci</div><div class="radky">
<div class="radekzaklinadla">$(words <i class="dopln">řetězec</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#7 </span>první/poslední/n-té slovo z řetězce</div><div class="radky">
<div class="radekzaklinadla">$(firstword <i class="dopln">řetězec</i>)</div>
<div class="radekzaklinadla">$(lastword <i class="dopln">řetězec</i>)</div>
<div class="radekzaklinadla">$(word <i class="dopln">n</i>,<i class="dopln">řetězec</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#8 </span>předposlední/před-předposlední slovo z řetězce</div><div class="radky">
<div class="radekzaklinadla">$(if $(word 2,<i class="dopln">řetězec</i>),$(word $(shell expr $(words <i class="dopln">řetězec</i> ) - 1),<i class="dopln">řetězec</i>),)</div>
<div class="radekzaklinadla">$(if $(word 3,<i class="dopln">řetězec</i>),$(word $(shell expr $(words <i class="dopln">řetězec</i> ) - 2),<i class="dopln">řetězec</i>),)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#9 </span>seřadit slova a odstranit duplicity</div><div class="radky">
<div class="radekzaklinadla">$(sort <i class="dopln">řetězec</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#10 </span>obrátit pořadí slov v řetězci</div><div class="radky">
<div class="radekzaklinadla">$(shell printf %s\\n '$(strip <i class="dopln">řetězec slov</i>)' | tr '<span class="viditelnamezera">&nbsp;</span>' \\n | tac)</div>
</div></div>

<h3 id="cast3x6"><span class="cislo">6</span> Analýza adresářových cest (pro každé slovo zvlášť)</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>získat adresářovou cestu (např. „../a/“)<sup><a href="#ppc6" id="ppcr6">(6)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(dir <i class="dopln">řetězec slov</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>získat samotný název souboru včetně přípony/bez přípony (např. „b.o“, resp. „b“)</div><div class="radky">
<div class="radekzaklinadla">$(notdir <i class="dopln">řetězec slov</i>)</div>
<div class="radekzaklinadla">$(basename $(notdir <i class="dopln">řetězec slov</i>))</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>získat příponu souboru (např. „.o“)<sup><a href="#ppc7" id="ppcr7">(7)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(suffix <i class="dopln">řetězec slov</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>získat adresářovou cestu (je-li uvedena) + název souboru bez přípony (např. „../a/b“)</div><div class="radky">
<div class="radekzaklinadla">$(basename <i class="dopln">řetězec slov</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>získat úplnou kanonickou cestu existujících souborů a adresářů (např. „/home/elli/test/a/b.o“)</div><div class="radky">
<div class="radekzaklinadla">$(realpath <i class="dopln">řetězec slov</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#6 </span>získat seznam existujících souborů a adresářů odpovídajících vzorku interpretu<sup><a href="#ppc8" id="ppcr8">(8)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(wildcard <i class="dopln">vzorek</i><span class="tritecky">...</span>)</div>
</div></div>

<h3 id="cast3x7"><span class="cislo">7</span> Logické funkce</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>podmíněný výraz</div><div class="radky">
<div class="radekzaklinadla">$(if <i class="dopln">podmínkový řetězec</i>,<i class="dopln">je-li neprázdný</i><span class="volznak">[</span>,<i class="dopln">jinak</i><span class="volznak">]</span>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>získat první neprázdný řetězec</div><div class="radky">
<div class="radekzaklinadla">$(or <i class="dopln">řetězec</i><span class="volznak">[</span>,<i class="dopln">další řetězec</i><span class="volznak">]</span><span class="tritecky">...</span>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>získat první prázdný řetězec, nebo jsou-li všechny neprázdné, poslední z nich</div><div class="radky">
<div class="radekzaklinadla">$(and <i class="dopln">řetězec</i><span class="volznak">[</span>,<i class="dopln">další řetězec</i><span class="volznak">]</span><span class="tritecky">...</span>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#4 </span>pro každé slovo ze seznamu toto slovo nastavit do proměnné a rozvinout podvýraz</div><div class="radky">
<div class="radekzaklinadla">$(foreach <i class="dopln">proměnná</i>,<i class="dopln">seznam</i>,<i class="dopln">podvýraz</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#5 </span>vrátí podřetězec, pokud se vyskytuje v řetězci; jinak vrátí prázdný řetězec</div><div class="radky">
<div class="radekzaklinadla">$(findstring <i class="dopln">podřetězec</i>,<i class="dopln">řetězec</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#6 </span>příklad − vrátí: aa bb cc cc bb aa</div><div class="radky">
<div class="radekzaklinadla">$(foreach PROM,a b c c b a,$(PROM)$(PROM))</div>
</div></div>

<h3 id="cast3x8"><span class="cislo">8</span> Příkazy v pravidlech</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>vykonat příkaz bez vypsání</div><div class="radky">
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>@<i class="dopln">příkaz</i></div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>vykonat příkaz a ignorovat návratovou hodnotu</div><div class="radky">
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>-<i class="dopln">příkaz</i></div>
</div></div>

<h3 id="cast3x9"><span class="cislo">9</span> Podmíněný překlad a include</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>podmíněný překlad<sup><a href="#ppc9" id="ppcr9">(9)</a></sup></div><div class="radky">
<div class="radekzaklinadla">ifeq &quot;<i class="dopln">výraz 1</i>&quot; &quot;<i class="dopln">výraz 2</i>&quot;</div>
<div class="radekzaklinadla"><i class="dopln">první alternativa</i></div>
<div class="radekzaklinadla"><span class="volznak">[</span>else ifeq &quot;<i class="dopln">výraz 1</i>&quot; &quot;<i class="dopln">výraz 2</i>&quot;</div>
<div class="radekzaklinadla"><i class="dopln">další alternativa</i><span class="volznak">]</span><span class="tritecky">...</span></div>
<div class="radekzaklinadla"><span class="volznak">[</span>else</div>
<div class="radekzaklinadla"><i class="dopln">poslední alternativa</i><span class="volznak">]</span></div>
<div class="radekzaklinadla">endif</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>načíst kód Makefilu z jiných souborů, jako by byl zde</div><div class="radky">
<div class="radekzaklinadla">include <i class="dopln">soubory</i><span class="tritecky">...</span></div>
</div></div>

<h3 id="cast3x10"><span class="cislo">10</span> Ostatní funkce</h3>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>vykonat příkaz v aktuálním shellu (typicky bash) a rozvinout se na jeho výstup; konce řádků se nahradí mezerami</div><div class="radky">
<div class="radekzaklinadla">$(shell <i class="dopln">příkaz shellu</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>vyvolat chybu a ukončit zpracování Makefile<sup><a href="#ppc10" id="ppcr10">(10)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(error <i class="dopln">popis chyby</i>)</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#3 </span>vypsat varování/zprávu<sup><a href="#ppc11" id="ppcr11">(11)</a></sup></div><div class="radky">
<div class="radekzaklinadla">$(warning <i class="dopln">popis varování</i>)</div>
<div class="radekzaklinadla">$(info <i class="dopln">zpráva</i>)</div>
</div></div>

<h2 id="cast4"><span class="cislo">4.</span> Parametry příkazů</h2>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>make</div><div class="radky">
<div class="radekzaklinadla">make <span class="volznak">[</span><i class="dopln">parametry</i><span class="volznak">]</span> <span class="volznak">[</span><i class="dopln">cíl</i><span class="volznak">]</span><span class="tritecky">...</span></div>
<div class="radekzaklinadla">$(MAKE) <span class="volznak">[</span><i class="dopln">parametry</i><span class="volznak">]</span> <span class="volznak">[</span><i class="dopln">cíl</i><span class="volznak">]</span><span class="tritecky">...</span></div>
</div></div>
<ul style="text-align:left"><li><b>-j</b> <i class="dopln">počet</i> :: umožní paralelní běh více úloh najednou
</li><li><b>-C</b> <i class="dopln">adresář</i> :: před děláním čehokoliv (dokonce i hledání Makefilu) vstoupí do zadaného adresáře
</li><li><b>-n</b> :: nespouští příkazy, pouze je vypíše
</li><li><b>-s</b> :: nevypisuje příkazy, pouze je spouští
</li><li>Není-li cíl zadán, použije se první cíl v Makefile (tradičně akce „all“).
</li></ul>
<h2 id="cast5"><span class="cislo">5.</span> Instalace na Ubuntu</h2>
<div class="zaklinadlo"><div class="radky">
<div class="radekzaklinadla">sudo apt-get install make</div>
</div></div>

<h2 id="cast6"><span class="cislo">6.</span> Ukázka</h2>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#1 </span>/home/elli/test/Makefile:</div><div class="radky">
<div class="radekzaklinadla"># Komentář</div>
<div class="radekzaklinadla">SHELL := /bin/sh</div>
<div class="radekzaklinadla">CXX := g++</div>
<div class="radekzaklinadla">CXXFLAGS := -Wall \</div>
<div class="radekzaklinadla">  -pedantic -DHOME=\&quot;$$HOME\&quot;</div>
<div class="radekzaklinadla">OBJS := main.o second.o</div>
<div class="radekzaklinadla">OBJS += hello.o</div>
<div class="radekzaklinadla">SOURCES := $(OBJS:%.o=%.cc)</div>
<div class="radekzaklinadla">.PHONY: all clean</div>
<div class="radekzaklinadla"></div>
<div class="radekzaklinadla">all: main</div>
<div class="radekzaklinadla">clean:</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(MAKE) -C lib clean</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(RM) $(OBJS)</div>
<div class="radekzaklinadla">main: $(OBJS)</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>@echo &quot;Koncové sestavení:&quot;</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(CXX) $(CXXFLAGS) -o $@ $^</div>
<div class="radekzaklinadla">main.o second.o: %.o: %.cc lib/hello.h</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(CXX) $(CXXFLAGS) -c -o $@ $&lt;</div>
<div class="radekzaklinadla">hello.o:</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(MAKE) -C lib hello.o</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>cp lib/hello.o $@</div>
</div></div>
<div class="zaklinadlo"><hr><div class="zahlavi"><span class="cislo">#2 </span>/home/elli/test/lib/Makefile:</div><div class="radky">
<div class="radekzaklinadla">.PHONY: clean</div>
<div class="radekzaklinadla">hello.o: hello.cc hello.h</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>g++ -o $@ -c -Wall -pedantic hello.cc</div>
<div class="radekzaklinadla">clean:</div>
<div class="radekzaklinadla"><span class="tab" style="width:8ch">&#9;</span>$(RM) hello.o</div>
</div></div>

<h2 id="cast7"><span class="cislo">7.</span> Tipy a zkušenosti</h2>
<ul style="text-align:justify"><li>Dlouhé řádky Makefilu můžete rozdělit, pokud před každý konec řádku, který má make ignorovat, vložíte zpětné lomítko. Rozdělíte-li řádek s příkazem, make toto rozdělení předá volanému interpretu příkazové řádky, což však u běžně používaných „sh“ a „bash“ nezpůsobí problémy.
</li><li>Nebojte se definovat více cílů v jednom pravidle. Funguje to stejně jako definovat stejné pravidlo pro každý uvedený cíl zvlášť a ušetří vám to spoustu práce s údržbou. Ze stejného důvodu se vyplatí naučit se syntaxi pravidla s %-vzorem.
</li><li>Pro jeden cíl můžete definovat více pravidel, pokud nejvýše jedno z nich bude deklarovat příkazy; v takovém případě se automaticky sloučí zdroje ze všech odpovídajících pravidel.
</li><li>Program make v příkazech pravidel interpretuje znak $. Má-li se předat shellu, je třeba jej zdvojit, např. <b>$$PATH</b> nebo <b>$$$$</b>. To platí i při uzavření do apostrofů.
</li><li>Některé textové editory mohou v závislosti na svém nastavení nahrazovat tabulátory mezerami či naopak. Pokud takovým editorem upravíte Makefile, přestane fungovat, protože na začátku každého příkazu v pravidle musí být tabulátor, ne posloupnost mezer.
</li><li>Obvyklé názvy akcí jsou např.: all, clean, install.
</li><li>Každý příkaz pravidla se při kompilaci spouští ve vlastní instanci interpretu příkazové řádky!
</li><li>Použitý interpret v příkazech a volání funkce $(shell) určuje proměnná <b>SHELL</b>. Kvůli přenositelnosti se doporučuje ji na začátku Makefile výslovně nastavit: <b>SHELL := /bin/sh</b> nebo <b>SHELL := /bin/bash</b>.
</li><li>Akce může mít jako zdroje soubory a další akce; ty budou přeloženy před vykonáním vlastní akce.
</li></ul>
<h2 id="cast8"><span class="cislo">8.</span> Jak získat nápovědu</h2>
<ul style="text-align:left"><li><b>make --help</b>
</li><li>Online GNU manuál (viz sekce Odkazy) (anglicky)
</li><li><b>man make</b> (anglicky)
</li></ul>
<h2 id="cast9"><span class="cislo">9.</span> Odkazy</h2>

<h3 id="cast9x1"><span class="cislo">1</span> Česky</h3>
<ul style="text-align:left"><li><a href="https://www.sallyx.org/sally/c/linux/makefile">Makefile na sallyx.org</a>
</li><li><a href="https://cs.wikipedia.org/wiki/Make">Stránka na Wikipedii</a>
</li><li><a href="http://www.linux.cz/noviny/1999-0304/clanek12.html">Rychlo-školička pro Makefile</a>
</li><li><a href="http://www.fit.vutbr.cz/~martinek/clang/make.html">Správa projektů pomocí programu Make</a>
</li></ul>
<h3 id="cast9x2"><span class="cislo">2</span> Anglicky</h3>
<ul style="text-align:left"><li><a href="https://www.gnu.org/software/make/manual/make.html">Oficiální manuál GNU make</a> (anglicky)
</li><li><a href="http://manpages.ubuntu.com/manpages/bionic/en/man1/make.1.html">Manuálová stránka</a> (anglicky)
</li><li><a href="https://packages.ubuntu.com/bionic/make">Balíček Ubuntu Bionic Beaver</a> (anglicky)
</li><li><a href="https://www.gnu.org/software/make/">Oficiální stránka GNU make</a> (anglicky)
</li></ul>
<h2 id="cast10"><span class="cislo">10.</span> Snímek obrazovky</h2>
<figure><img src="obrazky/make.png" alt="(snímek obrazovky)"></figure><div class="ppc"><div id="ppc1"><a href="#ppcr1" class="cislopozn">1</a>&nbsp;„endef“ musí být na samostatném řádku; operátor může být „=“, „:=“ nebo „+=“.</div>
<div id="ppc2"><a href="#ppcr2" class="cislopozn">2</a>&nbsp;Třetí uvedená varianta provede náhradu jen ve slovech, kde odpovídá prefix i suffix. Slova, u kterých odpovídá jen prefix nebo jen suffix, projdou bez náhrady.</div>
<div id="ppc3"><a href="#ppcr3" class="cislopozn">3</a>&nbsp;Obecné pravidlo má nižší prioritu než všechna pevná a generovaná pravidla. Navíc je tiše ignorováno, pokud chybí nekterý ze zdrojů. Má-li uvedeno víc cílů, považují se po jeho provedení všechny uvedené cíle za vygenerované, a tedy se pravidlo nevolá pro překlad dalších zdrojů znovu.</div>
<div id="ppc4"><a href="#ppcr4" class="cislopozn">4</a>&nbsp;Uvedený příklad předpokládá předdefinované proměnné CXX a CXXFLAGS, které GNU make předdefinovává, takže je nemusíte sami nastavovat.</div>
<div id="ppc5"><a href="#ppcr5" class="cislopozn">5</a>&nbsp;Při použití poslední uvedené varianty nesmějí text-před a text-za obsahovat znak %.</div>
<div id="ppc6"><a href="#ppcr6" class="cislopozn">6</a>&nbsp;Neobsahuje-li slovo žádné „/“, vrací pro něj $(dir) „./“.</div>
<div id="ppc7"><a href="#ppcr7" class="cislopozn">7</a>&nbsp;Pozor! Slova, která takovou příponu neobsahují, budou touto funkcí vynechána bez náhrady, což sníží počet slov ve výsledném řetězci.</div>
<div id="ppc8"><a href="#ppcr8" class="cislopozn">8</a>&nbsp;Vzorek příkazového interpretu může obsahovat znaky ? a * s významem obvyklým v bashi. Pokud vzorku neodpovídá žádný soubor ani adresář, vzorek se potichu přeskočí. Toho je možno použít k vynechání neexistujících souborů z proměnné.</div>
<div id="ppc9"><a href="#ppcr9" class="cislopozn">9</a>&nbsp;Vybere první z alternativ, kde jsou si uvedené výrazy po rozvinutí rovny. Doporučuji alternativy v Makefilu odsadit, ale není to vyžadováno.</div>
<div id="ppc10"><a href="#ppcr10" class="cislopozn">10</a>&nbsp;Tip: Popis chyby v parametru funkce $(error) může obsahovat rozvoj proměnných a volání funkcí.</div>
<div id="ppc11"><a href="#ppcr11" class="cislopozn">11</a>&nbsp;Výsledkem expanze funkcí $(warning) a $(info) je prázdný řetězec.</div>
<div class="zrusitzvyrazneni" id="zzv"><a href="#zzv">zrušit zvýraznění poznámky pod čarou</a></div></div>
<nav class="spodni"><span class="prev">
<a href="docker.htm" rel="prev" title="7. Docker">Předchozí&nbsp;kapitola</a>&nbsp;|
</span><a href="index.htm">Přehled</a><span class="next"><!--
-->&nbsp;| <a href="zpracovani-videa-a-zvuku.htm" rel="next" title="9. Zpracování videa a zvuku">Následující&nbsp;kapitola</a>
</span>
</nav>
</article>
<footer>
<img src="obrazky/by-sa.png" width="88" height="31" alt="[BY-SA]">
<p>Veškerý obsah této stránky (text, obrázky, zdrojový kód) je možno upravovat a šířit pod podmínkami licence
<a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>.
Upozorňuji, že uvedená licence vyžaduje uvedení seznamu autorů, licence a zdroje a poskytnutí stejné
či kompatibilní licence k provedeným změnám, jsou-li nějaké. Příslušné údaje jsou dostupné
na stránce „<a href="index.htm">Přehled</a>“.
Šíření obsahu bez těchto údajů nebo šíření upravené verze bez poskytnutí adekvátní
licence k provedeným úpravám je pravděpodobně porušení licenčních podmínek a může být postihováno.
Poskytování zdrojového kódu při šíření není touto licencí vyžadováno.</p><p>Pro nové verze, další informace, aktuální zdrojový kód
a možnost se zapojit do projektu „Linux: Kniha kouzel“ navštivte jeho
<a href="https://github.com/singularis-mzf/linux-spellbook">repozitář na GitHubu</a>.
</footer>
</body>
</html>
